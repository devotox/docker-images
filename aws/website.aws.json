{
    "family": "webserver",
    "AWSEBDockerrunVersion": 2,
    "containerDefinitions": [{
        "cpu": 1,
        "memory": 128,
        "name": "website",
        "image": "556352762989.dkr.ecr.us-east-1.amazonaws.com/doctify_website",
        "mountPoints": [{
            "containerPath": "/var/app/current/website/bower_components"
        }, {
            "containerPath": "/var/app/current/website/node_modules"
        }, {
            "containerPath": "/var/log/nodejs/website"
        }, {
            "containerPath": "/tmp/website"
        }]
    }, {
        "cpu": 2,
        "memory": 1024,
        "essential": true,
        "name": "api",
        "image": "556352762989.dkr.ecr.us-east-1.amazonaws.com/doctify_api",
        "mountPoints": [{
            "containerPath": "/var/app/current/security",
            "sourceVolume": "security-volume"
        }, {
            "containerPath": "/var/app/current/sslcert",
            "sourceVolume": "sslcert-volume"
        }, {
            "containerPath": "/var/app/current/api/bower_components"
        }, {
            "containerPath": "/var/app/current/api/node_modules"
        }, {
            "containerPath": "/var/log/nodejs/api"
        }, {
            "containerPath": "/tmp/api"
        }]
    }, {
        "cpu": 2,
        "memory": 512,
        "essential": true,
        "name": "server",
        "image": "556352762989.dkr.ecr.us-east-1.amazonaws.com/doctify_server",
        "volumesFrom": [{
            "sourceContainer": "api"
        }, {
            "sourceContainer": "website"
        }],
        "mountPoints": [{
            "containerPath": "/var/app/current/security",
            "sourceVolume": "security-volume"
        }, {
            "containerPath": "/var/app/current/sslcert",
            "sourceVolume": "sslcert-volume"
        }, {
            "sourceVolume": "awseb-logs-server",
            "containerPath": "/var/log/nginx"
        }, {
            "containerPath": "/tmp",
            "sourceVolume": "tmp-volume"
        }],
        "portMappings": [{
            "hostPort": 80,
            "containerPort": 80
        }, {
            "hostPort": 443,
            "containerPort": 443
        }]
    }, {
        "cpu": 1,
        "memory": 128,
        "essential": true,
        "name": "registrator",
        "image": "devotox/registrator",
        "links": ["consul"],
        "mountPoints": [{
            "containerPath": "/tmp/docker.sock",
            "sourceVolume": "docker-sock-volume"
        }, {
            "sourceVolume": "awseb-logs-registrator",
            "containerPath": "/var/log/registrator"
        }]
    }, {
        "cpu": 1,
        "memory": 128,
        "essential": true,
        "name": "consul",
        "image": "progrium/consul",
        "command": [
            "-ui-dir", "/ui",
            "-data-dir", "/data",
            "-server", "-bootstrap"
        ],
        "mountPoints": [{
            "sourceVolume": "awseb-logs-consul",
            "containerPath": "/var/log/consul"
        }],
        "portMappings": [{
            "containerPort": 53
        }, {
            "containerPort": 8301
        }, {
            "containerPort": 8302
        }, {
            "containerPort": 8400
        }, {
            "containerPort": 8300,
            "hostPort": 8300
        }, {
            "containerPort": 8500,
            "hostPort": 8500
        }, {
            "hostPort": 53,
            "containerPort": 53,
            "protocol": "udp"
        }, {
            "hostPort": 8301,
            "containerPort": 8301,
            "protocol": "udp"
        }, {
            "hostPort": 8302,
            "containerPort": 8302,
            "protocol": "udp"
        }]
    }, {
        "cpu": 1,
        "memory": 128,
        "essential": true,
        "name": "consul-template",
        "image": "masm/consul-template",
        "links": ["consul"],
        "command": [
            "-consul",
            "consul:8500",
            "-template", "/etc/nginx/templates/upstream_servers.ctmpl:/etc/nginx/conf.d/upstream_servers.conf",
            "-template", "/etc/nginx/templates/upstream_stream_servers.ctmpl:/etc/nginx/conf.d/streams/upstream_servers.conf"
        ],
        "volumesFrom": [{
            "sourceContainer": "server"
        }],
        "mountPoints": [{
            "containerPath": "/tmp/docker.sock",
            "sourceVolume": "docker-sock-volume"
        }, {
            "sourceVolume": "awseb-logs-consul-template",
            "containerPath": "/var/log/consul-template"
        }]
    }],
    "volumes": [{
        "host": {
            "sourcePath": "/var/app/current/security"
        },
        "name": "security-volume"
    }, {
        "host": {
            "sourcePath": "/var/app/current/sslcert"
        },
        "name": "sslcert-volume"
    }, {
        "host": {
            "sourcePath": "/var/app/current/nginx"
        },
        "name": "nginx-volume"
    }, {
        "host": {
            "sourcePath": "/var/log/nginx"
        },
        "name": "nginx-log-volume"
    }, {
        "host": {
            "sourcePath": "tmp"
        },
        "name": "tmp-volume"
    }, {
        "host": {
            "sourcePath": "/var/run/docker.sock"
        },
        "name": "docker-sock-volume"
    }]
}